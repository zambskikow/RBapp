<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Execução Fiscal - Portal Manager</title>
    <!-- Premium Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- FontAwesome for robust icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- Login Screen Overlay -->
    <div id="login-overlay" class="login-fullscreen active">
        <div class="glass-card login-card">
            <div class="logo login-logo">
                <i class="fa-solid fa-chart-line"></i> FiscalApp
            </div>
            <h2>Acesso ao Sistema</h2>
            <p style="color:var(--text-muted); margin-bottom: 2rem; font-size: 0.9rem;">Insira suas credenciais para
                continuar</p>

            <form id="login-form">
                <div class="form-group">
                    <label>Usuário</label>
                    <input type="text" id="login-username" class="glass-input" placeholder="Seu nome (Ex: Manager)"
                        required>
                </div>
                <div class="form-group" style="margin-bottom: 2rem;">
                    <label>Senha</label>
                    <input type="password" id="login-password" class="glass-input" placeholder="Sua senha" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 0.9rem; font-size: 1.05rem;">
                    <i class="fa-solid fa-right-to-bracket"></i> Entrar
                </button>
            </form>
            <p id="login-error"
                style="color:var(--danger); margin-top: 1rem; font-size: 0.85rem; display:none; text-align:center;">
                Usuário ou senha inválidos.</p>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container" style="display:none;" id="main-app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar glass-panel">
            <div class="logo">
                <i class="fa-solid fa-chart-line"></i>
                <span>RB|App</span>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-view="dashboard">
                    <i class="fa-solid fa-gauge"></i>
                    <span>Manager Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-view="operacional">
                    <i class="fa-solid fa-list-check"></i>
                    <span>Painel Operacional</span>
                </a>
                <a href="#" class="nav-item" data-view="clientes">
                    <i class="fa-solid fa-users"></i>
                    <span>Gestão de Clientes</span>
                </a>

                <a href="#" class="nav-item" data-view="meu-desempenho">
                    <i class="fa-solid fa-chart-pie"></i>
                    <span>Meu Desempenho</span>
                </a>
                <a href="#" class="nav-item" data-view="rotinas">
                    <i class="fa-solid fa-layer-group"></i>
                    <span>Gestão de Rotinas</span>
                </a>
                <a href="#" class="nav-item" data-view="mensagens">
                    <i class="fa-solid fa-envelope"></i>
                    <span>Mensagens</span>
                </a>

                <div class="nav-divider" id="admin-nav-divider" style="display: none;"></div>

                <a href="#" class="nav-item" data-view="settings" id="nav-settings" style="display: none;">
                    <i class="fa-solid fa-gear"></i>
                    <span>Painel de Controle</span>
                </a>
            </nav>
            <div class="user-profile">
                <img src="https://ui-avatars.com/api/?name=Admin&background=6366f1&color=fff" alt="Avatar"
                    class="avatar">
                <div class="user-info">
                    <span class="user-name">Manager</span>
                    <span class="user-role">Setor Fiscal</span>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Top Navigation Bar -->
            <header class="topbar glass-bar">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button id="btn-toggle-sidebar" class="action-btn" title="Recolher/Expandir Menu Lateral">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                    <div style="flex: 1;"></div> <!-- Spacer replacing search bar -->
                </div>
                <div class="topbar-actions">
                    <button class="action-btn" onclick="document.querySelector('[data-view=mensagens]').click()">
                        <i class="fa-solid fa-bell"></i>
                        <span class="badge" id="topbar-badge-msg" style="display:none;">0</span>
                    </button>
                    <div class="date-display" id="currentDate">--/--/----</div>
                    <button id="btn-logout" class="btn btn-outline"
                        style="border-color: var(--danger); color: var(--danger); font-size: 0.85rem; padding: 0.4rem 1rem;">
                        <i class="fa-solid fa-power-off"></i> Sair
                    </button>
                </div>
            </header>

            <!-- Dashboard View (Manager) -->
            <div id="view-dashboard" class="view-section active">
                <header class="section-header">
                    <div>
                        <h1>Visão Geral do Mês</h1>
                        <p class="subtitle">Acompanhe a saúde das entregas fiscais</p>
                    </div>
                    <div class="header-actions" style="display:flex; gap:0.5rem; align-items:center;">
                        <select id="dash-competencia-filter" class="glass-select" style="min-width: 130px;">
                            <!-- Populated dynamically -->
                        </select>
                        <select id="dash-user-filter" class="glass-select" style="min-width: 130px;">
                            <option value="All">Todos Analistas</option>
                            <!-- Populated dynamically -->
                        </select>
                        <select id="dash-client-filter" class="glass-select" style="min-width: 130px;">
                            <option value="All">Todos Clientes</option>
                            <!-- Populated dynamically -->
                        </select>
                        <button class="btn btn-primary" onclick="window.print()"><i class="fa-solid fa-print"></i>
                            Relatório</button>
                    </div>
                </header>

                <!-- KPI Cards -->
                <div class="kpi-grid">
                    <div class="glass-card kpi-card">
                        <div class="kpi-icon"><i class="fa-solid fa-list-check"></i></div>
                        <div class="kpi-data">
                            <h3>Total Execuções</h3>
                            <p class="kpi-value" id="kpi-total">0</p>
                        </div>
                    </div>
                    <div class="glass-card kpi-card status-success">
                        <div class="kpi-icon"><i class="fa-solid fa-check-double"></i></div>
                        <div class="kpi-data">
                            <h3>Concluídos</h3>
                            <p class="kpi-value" id="kpi-done">0</p>
                        </div>
                    </div>
                    <div class="glass-card kpi-card status-info">
                        <div class="kpi-icon"><i class="fa-solid fa-bars-progress"></i></div>
                        <div class="kpi-data">
                            <h3>Em Andamento</h3>
                            <p class="kpi-value" id="kpi-andamento">0</p>
                        </div>
                    </div>
                    <div class="glass-card kpi-card status-warning">
                        <div class="kpi-icon"><i class="fa-solid fa-hourglass-half"></i></div>
                        <div class="kpi-data">
                            <h3>Vencendo Hoje</h3>
                            <p class="kpi-value" id="kpi-warning">0</p>
                        </div>
                    </div>
                    <div class="glass-card kpi-card status-danger">
                        <div class="kpi-icon"><i class="fa-solid fa-triangle-exclamation"></i></div>
                        <div class="kpi-data">
                            <h3>Atrasados</h3>
                            <p class="kpi-value" id="kpi-late">0</p>
                        </div>
                    </div>
                </div>

                <!-- Charts & Critical Actions -->
                <div class="charts-grid">
                    <div class="glass-card chart-container">
                        <h3>Status Semáforo (Saúde)</h3>
                        <div class="chart-wrapper">
                            <canvas id="semaforoChart"></canvas>
                        </div>
                    </div>
                    <div class="glass-card table-container">
                        <div class="table-header-action">
                            <h3>Ações Críticas (Gargalos)</h3>
                            <span class="table-filter-info">Prioridade Máxima</span>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="critical-table">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Rotina</th>
                                        <th>Resp.</th>
                                        <th>Prazo</th>
                                        <th>Status Auto</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Desempenho da Equipe -->
                <div class="glass-card full-table-container" style="margin-top: 1.5rem;">
                    <div class="table-header-action">
                        <h3>Desempenho da Equipe</h3>
                        <span class="table-filter-info">Produtividade no Período</span>
                    </div>
                    <div class="table-responsive">
                        <table class="data-table" id="team-performance-table">
                            <thead>
                                <tr>
                                    <th>Funcionário</th>
                                    <th>Total Entregas</th>
                                    <th>Concluídas</th>
                                    <th>Vencendo Hoje</th>
                                    <th>Atrasadas</th>
                                    <th>% Rendimento</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Meu Desempenho View (Individual KPIs) -->
            <div id="view-meu-desempenho" class="view-section" style="display: none;">
                <header class="section-header">
                    <div>
                        <h1>Meu Desempenho</h1>
                        <p class="subtitle">Acompanhe suas metas e produtividade individual</p>
                    </div>
                    <div class="header-actions" style="display:flex; gap:0.5rem; align-items:center;">
                        <select id="meu-competencia-filter" class="glass-select" style="min-width: 140px;">
                            <!-- Populated dynamically -->
                        </select>
                        <button class="btn btn-primary" onclick="window.print()"><i class="fa-solid fa-print"></i>
                            Imprimir Extrato</button>
                    </div>
                </header>

                <div class="kpi-grid">
                    <div class="glass-card kpi-card">
                        <div class="kpi-icon"><i class="fa-solid fa-bullseye"></i></div>
                        <div class="kpi-data">
                            <h3>Total de Tarefas</h3>
                            <p class="kpi-value" id="kpi-meu-total">0</p>
                        </div>
                    </div>
                    <div class="glass-card kpi-card status-success">
                        <div class="kpi-icon"><i class="fa-solid fa-trophy"></i></div>
                        <div class="kpi-data">
                            <h3>Concluídas</h3>
                            <p class="kpi-value" id="kpi-meu-done">0</p>
                        </div>
                    </div>
                    <div class="glass-card kpi-card status-warning">
                        <div class="kpi-icon"><i class="fa-solid fa-hourglass-half"></i></div>
                        <div class="kpi-data">
                            <h3>Vencendo Hoje</h3>
                            <p class="kpi-value" id="kpi-meu-warning">0</p>
                        </div>
                    </div>
                    <div class="glass-card kpi-card status-danger">
                        <div class="kpi-icon"><i class="fa-solid fa-skull-crossbones"></i></div>
                        <div class="kpi-data">
                            <h3>Atrasadas</h3>
                            <p class="kpi-value" id="kpi-meu-late">0</p>
                        </div>
                    </div>
                </div>

                <div class="charts-grid" style="margin-top: 1.5rem;">
                    <div class="glass-card table-container" style="flex: 1;">
                        <div class="table-header-action">
                            <h3>Minhas Próximas Entregas (Prioridade)</h3>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="minhas-proximas-table">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Rotina</th>
                                        <th>Prazo</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Operacional View (User Area) -->
            <div id="view-operacional" class="view-section" style="display: none;">
                <header class="section-header">
                    <div>
                        <h1>Minhas Tarefas</h1>
                        <p class="subtitle">Gestão diária de rotinas fiscais e documentação</p>
                    </div>
                    <div class="header-actions" style="display:flex; gap:0.5rem; align-items:center;">
                        <select id="competencia-filter" class="glass-select" style="min-width: 140px;">
                            <!-- Populated dynamically by JS -->
                        </select>
                        <select id="user-filter" class="glass-select">
                            <option value="All">Todos os Responsáveis</option>
                            <option value="Dandara">Dandara</option>
                            <option value="Manager">Manager</option>
                        </select>
                    </div>
                </header>

                <div id="operacional-groups-container">
                    <!-- Routine Groups injected by app.js here -->
                </div>
            </div>

            <!-- Client Management View -->
            <div id="view-clientes" class="view-section" style="display: none;">
                <header class="section-header">
                    <div>
                        <h1>Gestão de Clientes</h1>
                        <p class="subtitle">Base de clientes e Painel de Rotinas Fiscais</p>
                    </div>
                    <div class="header-actions" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button class="btn btn-danger" id="btn-delete-clients"
                            style="display: none; background: var(--danger);">
                            <i class="fa-solid fa-trash"></i> Excluir Selecionados <span class="badge"
                                id="delete-clients-badge">0</span>
                        </button>
                        <button class="btn btn-primary" id="btn-add-client">
                            <i class="fa-solid fa-plus"></i> Novo Cliente
                        </button>
                    </div>
                </header>

                <div class="kpi-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="glass-card kpi-card">
                        <div class="kpi-icon"><i class="fa-solid fa-users"></i></div>
                        <div class="kpi-data">
                            <h3>Total Clientes</h3>
                            <p class="kpi-value" id="kpi-total-clientes">0</p>
                        </div>
                    </div>
                    <div class="glass-card kpi-card">
                        <div class="kpi-icon" style="background: rgba(139, 92, 246, 0.15); color: var(--accent);"><i
                                class="fa-solid fa-building"></i></div>
                        <div class="kpi-data">
                            <h3>Simples Nacional</h3>
                            <p class="kpi-value" id="kpi-simples">0</p>
                        </div>
                    </div>
                    <div class="glass-card kpi-card">
                        <div class="kpi-icon" style="background: rgba(16, 185, 129, 0.15); color: var(--success);"><i
                                class="fa-solid fa-scale-balanced"></i></div>
                        <div class="kpi-data">
                            <h3>Demais Regimes</h3>
                            <p class="kpi-value" id="kpi-outros-regimes">0</p>
                        </div>
                    </div>
                </div>

                <div class="glass-card full-table-container">
                    <div class="table-responsive">
                        <table class="data-table" id="clients-table">
                            <thead>
                                <tr>
                                    <th style="width: 40px; text-align: center;">
                                        <input type="checkbox" id="select-all-clients" class="custom-checkbox">
                                    </th>
                                    <th>Cód</th>
                                    <th>Razão Social</th>
                                    <th>CNPJ</th>
                                    <th>Regime Tributário</th>
                                    <th>Responsável Fiscal</th>
                                    <th>Status Motor</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Rotinas Base Management View -->
            <div id="view-rotinas" class="view-section" style="display: none;">

                <!-- Main List Panel -->
                <div id="rotinas-list-panel">
                    <header class="section-header">
                        <div>
                            <h1>Gestão de Rotinas</h1>
                            <p class="subtitle">Administração das matrizes de rotinas e prazos padrão</p>
                        </div>
                        <div class="header-actions" style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" id="btn-manage-setores">
                                <i class="fa-solid fa-layer-group"></i> Gerenciar Setores
                            </button>
                            <button class="btn btn-primary" id="btn-add-rotina">
                                <i class="fa-solid fa-plus"></i> Nova Rotina
                            </button>
                        </div>
                    </header>

                    <div class="glass-card full-table-container">
                        <div class="table-responsive">
                            <table class="data-table" id="rotinas-table">
                                <thead>
                                    <tr>
                                        <th>Nome da Rotina</th>
                                        <th>Frequência</th>
                                        <th>Setor</th>
                                        <th>Dia de Vencimento Padrão</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Detail Panel for New/Edit Routine -->
                <div class="glass-card fade-in" id="rotinas-detail-panel" style="display: none; padding: 2rem;">
                    <header class="section-header"
                        style="margin-bottom: 2rem; border-bottom: 1px solid var(--border-glass); padding-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <button class="btn btn-secondary" id="btn-back-rotinas-list" type="button"
                                style="padding: 0.5rem 1rem;">
                                <i class="fa-solid fa-arrow-left"></i> Voltar
                            </button>
                            <h2 id="modal-rotina-title"><i class="fa-solid fa-layer-group highlight-text"></i> Nova
                                Rotina</h2>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-primary" form="add-rotina-form" type="submit"
                                id="btn-save-rotina-detail" style="padding: 0.5rem 1.5rem; font-size: 1rem;">
                                <i class="fa-solid fa-save"></i> Salvar Rotina
                            </button>
                        </div>
                    </header>

                    <div class="modal-body" style="padding-bottom: 0;">
                        <form id="add-rotina-form">
                            <input type="hidden" id="rotina-id" value="">

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                                <!-- Left Column: Routine Settings -->
                                <div>
                                    <h3 style="margin-bottom: 1rem; color: var(--text-main); font-size: 1.1rem;"><i
                                            class="fa-solid fa-sliders"></i> Configurações da Rotina</h3>

                                    <div class="form-group" style="margin-bottom: 1rem;">
                                        <label>Nome da Rotina</label>
                                        <input type="text" id="rotina-nome" required class="glass-input"
                                            placeholder="Ex: Declaração XPTO">
                                    </div>
                                    <div class="form-grid" style="margin-bottom: 1rem;">
                                        <div class="form-group">
                                            <label>Frequência</label>
                                            <select id="rotina-frequencia" class="glass-select" style="width: 100%;">
                                                <option value="Mensal">Mensal (Dia fixo)</option>
                                                <option value="Anual">Anual (Data exata)</option>
                                                <option value="Eventual">Eventual (Por Demanda)</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Setor Relacionado</label>
                                            <select id="rotina-setor" class="glass-select" style="width: 100%;">
                                                <!-- Populated dynamically by JS -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-grid" style="margin-bottom: 1rem;">
                                        <div class="form-group">
                                            <label>Responsáveis Pela Rotina</label>
                                            <div id="rotina-responsavel-grid" class="form-grid"
                                                style="gap: 0.5rem; margin-top: 0.5rem; max-height: 150px; overflow-y: auto; padding: 0.5rem; background: rgba(0,0,0,0.05); border-radius: 4px; grid-template-columns: 1fr 1fr;">
                                                <!-- Checkboxes injected by app.js -->
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label id="label-rotina-prazo">Dia Vencimento Padrão (1 a 31)</label>
                                            <input type="text" id="rotina-prazo" required class="glass-input"
                                                placeholder="Ex: 15">
                                        </div>
                                    </div>
                                    <div class="form-group" style="margin-top: 1.5rem;">
                                        <label>Itens do Checklist Padrão</label>
                                        <div style="display:flex; gap:0.5rem; margin-bottom:0.8rem;">
                                            <input type="text" id="new-checklist-item" class="glass-input"
                                                placeholder="Ex: Baixar XML">
                                            <button type="button" class="btn btn-secondary" id="btn-add-checklist-item"
                                                style="padding: 0 1rem;"><i class="fa-solid fa-plus"></i></button>
                                        </div>
                                        <ul id="rotina-checklist-preview"
                                            style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:0.4rem; max-height: 200px; overflow-y: auto;">
                                            <!-- Injetado por JS -->
                                        </ul>
                                    </div>
                                </div>

                                <!-- Right Column: Linked Clients -->
                                <div
                                    style="background: rgba(0,0,0,0.1); padding: 1.5rem; border-radius: var(--radius-md); border: 1px solid var(--border-glass);">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <h3 style="margin: 0; color: var(--text-main); font-size: 1.1rem;"><i
                                                class="fa-solid fa-users"></i> Clientes Vinculados</h3>
                                        <div
                                            style="display: flex; align-items: center; gap: 0.5rem; justify-content: flex-end;">
                                            <input type="text" id="filter-clientes-rotina"
                                                placeholder="Buscar cliente..." class="glass-input"
                                                style="width: 0; opacity: 0; padding: 0; border: none; height: 32px; transition: all 0.3s ease-in-out; pointer-events: none;">
                                            <button type="button" class="btn btn-secondary"
                                                id="btn-toggle-client-search" title="Buscar Clientes"
                                                style="padding: 0; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                                <i class="fa-solid fa-magnifying-glass"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <p
                                        style="font-weight:400; font-size:0.85rem; color:var(--text-muted); margin-bottom: 1rem;">
                                        Marque os clientes que devem realizar esta rotina.</p>

                                    <div class="form-group">
                                        <div id="clientes-checkbox-grid" class="form-grid"
                                            style="gap: 0.8rem; grid-template-columns: 1fr 1fr; margin-top: 0.5rem; max-height: 400px; overflow-y: auto; padding: 0.5rem;">
                                            <!-- Checkboxes injected by app.js -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Caixa de Mensagens View (Layout Inbox Email) -->
            <div id="view-mensagens" class="view-section"
                style="display: none; padding: 2rem 3rem 0; height: calc(100vh - var(--topbar-height)); overflow: hidden;">
                <header class="section-header" style="margin-bottom: 1rem;">
                    <div>
                        <h1>Comunicações</h1>
                        <p class="subtitle">Caixa de Entrada e Notificações do Sistema</p>
                    </div>
                </header>

                <div class="inbox-layout">
                    <!-- Inbox Sidebar (Folders) -->
                    <div class="inbox-sidebar glass-panel">
                        <button class="btn btn-primary" id="btn-nova-mensagem"
                            style="width: 100%; margin-bottom: 1.5rem;">
                            <i class="fa-solid fa-pen-to-square"></i> Nova Mensagem
                        </button>

                        <nav class="inbox-menu">
                            <button class="inbox-menu-item active" data-folder="inbox">
                                <div><i class="fa-solid fa-inbox highlight-text"></i> Caixa de Entrada</div>
                                <span class="badge" id="inbox-unread-badge"
                                    style="position:static; padding: 2px 6px;">0</span>
                            </button>
                            <button class="inbox-menu-item" data-folder="sent">
                                <div><i class="fa-solid fa-paper-plane highlight-text"></i> Enviados</div>
                            </button>
                            <button class="inbox-menu-item" data-folder="system">
                                <div><i class="fa-solid fa-robot highlight-text"></i> Alertas do Sistema</div>
                            </button>
                        </nav>
                    </div>

                    <!-- Inbox List View -->
                    <div class="inbox-list glass-card">
                        <div class="inbox-list-header">
                            <h3 id="inbox-current-folder-title">Caixa de Entrada</h3>
                            <button class="action-btn" id="btn-refresh-inbox"><i
                                    class="fa-solid fa-rotate-right"></i></button>
                        </div>
                        <div id="mensagens-container" class="inbox-scroll-area">
                            <!-- Lista de mensagens injetada aqui -->
                        </div>
                    </div>

                    <!-- Inbox Reading Pane -->
                    <div class="inbox-reading-pane glass-card" id="inbox-reader">
                        <div class="empty-reader-state">
                            <i class="fa-regular fa-envelope-open"
                                style="font-size: 3rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
                            <p>Selecione uma mensagem para ler</p>
                        </div>
                        <div class="reader-content fade-in" style="display: none;">
                            <!-- Header da mensagem -->
                            <div class="reader-header">
                                <h2 id="reader-subject">Assunto da Mensagem</h2>
                                <div class="reader-meta">
                                    <div class="reader-sender">
                                        <div class="avatar-small"><i class="fa-solid fa-user"></i></div>
                                        <div>
                                            <strong id="reader-from">Remetente</strong>
                                            <div id="reader-date" style="font-size: 0.8rem; color: var(--text-muted)">
                                                Data</div>
                                        </div>
                                    </div>
                                    <div class="reader-actions">
                                        <button class="btn btn-outline" id="btn-reply-msg"><i
                                                class="fa-solid fa-reply"></i> Responder</button>
                                        <button class="action-btn text-danger" id="btn-delete-msg"><i
                                                class="fa-solid fa-trash"></i></button>
                                    </div>
                                </div>
                            </div>
                            <!-- Corpo da mensagem -->
                            <div class="reader-body" id="reader-body-content">
                                <!-- Texto injetado -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Global Settings Hub View -->
            <div id="view-settings" class="view-section" style="display: none;">
                <header class="section-header">
                    <div>
                        <h1><i class="fa-solid fa-gear highlight-text"></i> Painel de Controle Administrativo</h1>
                        <p class="subtitle">Centro de Comando do Sistema. Acesse as opções pelo menu lateral abaixo.</p>
                    </div>
                </header>

                <div class="settings-layout"
                    style="display: grid; grid-template-columns: 250px 1fr; gap: 2rem; align-items: start;">
                    <!-- Settings Left Menu (Tabs) -->
                    <div class="glass-panel settings-sidebar" style="padding: 1rem; position: sticky; top: 20px;">
                        <nav class="settings-menu" style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <button class="settings-tab-btn active" data-target="set-rbac"
                                style="text-align: left; padding: 1rem; border-radius: var(--radius-sm); border: none; background: rgba(99, 102, 241, 0.2); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 10px; font-weight: 500; transition: all 0.3s ease;">
                                <i class="fa-solid fa-shield-halved" style="width: 20px;"></i> Segurança e Acessos
                            </button>
                            <button class="settings-tab-btn" data-target="set-equipe"
                                style="text-align: left; padding: 1rem; border-radius: var(--radius-sm); border: none; background: transparent; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.3s ease;">
                                <i class="fa-solid fa-users" style="width: 20px;"></i> Contas e Equipe
                            </button>
                            <button class="settings-tab-btn" data-target="set-backup"
                                style="text-align: left; padding: 1rem; border-radius: var(--radius-sm); border: none; background: transparent; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.3s ease;">
                                <i class="fa-solid fa-cloud-arrow-down" style="width: 20px;"></i> Backups de Sistema
                            </button>
                            <div class="nav-divider" style="margin: 0.5rem 0;"></div>
                            <button class="settings-tab-btn" data-target="set-auditoria"
                                style="text-align: left; padding: 1rem; border-radius: var(--radius-sm); border: none; background: transparent; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.3s ease;">
                                <i class="fa-solid fa-clipboard-list" style="width: 20px;"></i> Logs de Atividade
                            </button>
                            <button class="settings-tab-btn" data-target="set-auditoria-comp"
                                style="text-align: left; padding: 1rem; border-radius: var(--radius-sm); border: none; background: transparent; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.3s ease;">
                                <i class="fa-solid fa-magnifying-glass-chart" style="width: 20px;"></i> Auditoria de
                                Competência
                            </button>
                        </nav>
                    </div>

                    <!-- Settings Content Panes -->
                    <div class="settings-content">

                        <!-- TAB: Segurança / Cargos / RBAC -->
                        <div class="settings-pane active fade-in" id="set-rbac">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <div>
                                    <h2 style="font-size: 1.25rem;">Cargos e Permissões</h2>
                                    <p style="color: var(--text-muted); font-size: 0.9rem;">Crie perfis e defina quais
                                        telas eles podem ver.</p>
                                </div>
                                <button class="btn btn-primary" id="btn-add-cargo">
                                    <i class="fa-solid fa-shield-plus"></i> Novo Cargo
                                </button>
                            </div>
                            <div class="glass-card full-table-container">
                                <div class="table-responsive">
                                    <table class="data-table" id="admin-cargos-table">
                                        <thead>
                                            <tr>
                                                <th>Cód.</th>
                                                <th>Nome do Cargo</th>
                                                <th>Telas Permitidas</th>
                                                <th style="text-align: right;">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Populated by JS -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- TAB: Gestão de Equipe -->
                        <div class="settings-pane fade-in" id="set-equipe" style="display: none;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <div>
                                    <h2 style="font-size: 1.25rem;">Gestão de Contas (Equipe)</h2>
                                    <p style="color: var(--text-muted); font-size: 0.9rem;">Crie, inative e edite
                                        funcionários do sistema.</p>
                                </div>
                                <button class="btn btn-primary" id="btn-add-equipe">
                                    <i class="fa-solid fa-user-plus"></i> Nova Conta
                                </button>
                            </div>

                            <div class="kpi-grid" style="margin-bottom: 1.5rem;">
                                <div class="glass-card kpi-card" style="padding: 1rem;">
                                    <div class="kpi-icon"
                                        style="background: rgba(99, 102, 241, 0.15); color: var(--primary); font-size: 1.2rem; width: 40px; height: 40px;">
                                        <i class="fa-solid fa-users-viewfinder"></i>
                                    </div>
                                    <div class="kpi-data">
                                        <h3 style="font-size: 0.8rem;">Total Equipe</h3>
                                        <p class="kpi-value" id="kpi-total-equipe" style="font-size: 1.5rem;">0</p>
                                    </div>
                                </div>
                                <div class="glass-card kpi-card status-success" style="padding: 1rem;">
                                    <div class="kpi-icon" style="font-size: 1.2rem; width: 40px; height: 40px;"><i
                                            class="fa-solid fa-user-check"></i></div>
                                    <div class="kpi-data">
                                        <h3 style="font-size: 0.8rem;">Contas Ativas</h3>
                                        <p class="kpi-value" id="kpi-equipe-ativos" style="font-size: 1.5rem;">0</p>
                                    </div>
                                </div>
                                <div class="glass-card kpi-card status-danger" style="padding: 1rem;">
                                    <div class="kpi-icon" style="font-size: 1.2rem; width: 40px; height: 40px;"><i
                                            class="fa-solid fa-user-xmark"></i></div>
                                    <div class="kpi-data">
                                        <h3 style="font-size: 0.8rem;">Contas Inativas</h3>
                                        <p class="kpi-value" id="kpi-equipe-inativos" style="font-size: 1.5rem;">0</p>
                                    </div>
                                </div>
                            </div>

                            <div class="glass-card full-table-container">
                                <div class="table-responsive">
                                    <table class="data-table" id="equipe-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Nome</th>
                                                <th>Setor</th>
                                                <th>Permissão (Perfil)</th>
                                                <th>Status</th>
                                                <th style="text-align: right;">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Populated by JS -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>


                        <!-- TAB: Backup -->
                        <div class="settings-pane fade-in" id="set-backup" style="display: none;">
                            <div style="margin-bottom: 1.5rem;">
                                <h2 style="font-size: 1.25rem;">Backup e Recuperação</h2>
                                <p style="color: var(--text-muted); font-size: 0.9rem;">Garanta a segurança dos seus
                                    dados realizando cópias locais.</p>
                            </div>
                            <div class="kpi-grid" style="grid-template-columns: 1fr 1fr;">
                                <div class="glass-card table-container">
                                    <h3 style="margin-bottom: 1rem; color: var(--primary);"><i
                                            class="fa-solid fa-download"></i> Fazer Backup</h3>
                                    <p
                                        style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 1.5rem; line-height: 1.5;">
                                        Faça o download de um arquivo ".json" contendo 100% dos dados atuais do sistema.
                                    </p>
                                    <button class="btn btn-primary" id="btn-export-backup" style="width: 100%;"><i
                                            class="fa-solid fa-file-export"></i> Baixar Base de Dados Agora</button>
                                    <div
                                        style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center;">
                                        <label>Lembrete de Auto-Backup</label>
                                        <label class="switch"><input type="checkbox" id="toggle-auto-backup"><span
                                                class="slider round"></span></label>
                                    </div>
                                    <p style="margin-top: 0.5rem; font-size: 0.8em; color: var(--text-muted); text-align: right;"
                                        id="last-backup-text">Último: Nunca</p>
                                </div>
                                <div class="glass-card table-container"
                                    style="border: 1px solid rgba(239, 68, 68, 0.3);">
                                    <h3 style="margin-bottom: 1rem; color: var(--danger);"><i
                                            class="fa-solid fa-upload"></i> Restaurar Sistema</h3>
                                    <p
                                        style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 1.5rem; line-height: 1.5;">
                                        Suba um backup anterior (isto apagará os dados atuais do momento).</p>
                                    <input type="file" id="backup-file-input" accept=".json" class="glass-input"
                                        style="padding: 0.5rem; margin-bottom: 1rem; width: 100%;">
                                    <button class="btn btn-primary" id="btn-restore-backup"
                                        style="width: 100%; background: var(--danger);"><i
                                            class="fa-solid fa-rotate-left"></i> Esmagar Base Atual e Restaurar</button>
                                </div>
                            </div>
                        </div>

                        <!-- TAB: Logs Auditoria Geral -->
                        <div class="settings-pane fade-in" id="set-auditoria" style="display: none;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <div>
                                    <h2 style="font-size: 1.25rem;">Auditoria de Sistema (Logs)</h2>
                                    <p style="color: var(--text-muted); font-size: 0.9rem;">Rastreador de acessos,
                                        exclusões e modificações globais na base.</p>
                                </div>
                                <button class="btn btn-secondary" id="btn-export-logs">
                                    <i class="fa-solid fa-file-csv"></i> Exportar CSV
                                </button>
                            </div>
                            <div class="glass-card full-table-container">
                                <div class="table-responsive">
                                    <table class="data-table" id="auditoria-table">
                                        <thead>
                                            <tr>
                                                <th>Data / Hora</th>
                                                <th>Usuário</th>
                                                <th>Permissão</th>
                                                <th>Ação Registrada</th>
                                                <th>Detalhes Adicionais</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Populated by JS -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- TAB: Auditoria de Competência O FOCO DA ENTREGA -->
                        <div class="settings-pane fade-in" id="set-auditoria-comp" style="display: none;">
                            <div style="margin-bottom: 1.5rem;">
                                <h2 style="font-size: 1.25rem;">Auditoria de Competência (Histórico Fiel)</h2>
                                <p style="color: var(--text-muted); font-size: 0.9rem;">Volte no tempo e descubra como
                                    foi o desempenho de um funcionário em um mês específico (Data exata de baixa, se
                                    quebrou o prazo, etc).</p>
                            </div>
                            <div class="glass-card table-container" style="margin-bottom: 1rem;">
                                <div style="display: flex; gap: 1rem; align-items: flex-end;">
                                    <div class="form-group" style="flex: 1;">
                                        <label>Selecione a Competência (Mês/Ano Passado)</label>
                                        <select id="audit-comp-mes" class="glass-select" style="width: 100%;"></select>
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label>Selecione o Funcionário a ser Auditado</label>
                                        <select id="audit-comp-user" class="glass-select" style="width: 100%;"></select>
                                    </div>
                                    <button class="btn btn-primary" id="btn-run-audit-comp"
                                        style="height: 48px; min-width: 150px; justify-content: center;">
                                        <i class="fa-solid fa-magnifying-glass"></i> Auditar
                                    </button>
                                </div>
                            </div>

                            <!-- Resultados da Auditoria de Competência -->
                            <div class="glass-card full-table-container" id="audit-comp-results" style="display: none;">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-glass);">
                                    <div>
                                        <h3 style="margin:0; font-size: 1.1rem; color: var(--primary-light);">Relatório
                                            Fiel de Baixas</h3>
                                        <p id="audit-comp-subtitle"
                                            style="margin:0; font-size: 0.85rem; color: var(--text-muted);">Resultados
                                            para Dandara em Janeiro de 2026</p>
                                    </div>
                                    <div style="display: flex; gap: 1rem;">
                                        <div style="text-align: center;"><span
                                                style="font-size: 1.2rem; font-weight: bold; color: var(--success);"
                                                id="audit-comp-noprazo">0</span>
                                            <div style="font-size:0.7rem; color:var(--text-muted);">No Prazo</div>
                                        </div>
                                        <div style="text-align: center;"><span
                                                style="font-size: 1.2rem; font-weight: bold; color: var(--danger);"
                                                id="audit-comp-atrasado">0</span>
                                            <div style="font-size:0.7rem; color:var(--text-muted);">Atrasados</div>
                                        </div>
                                        <div style="text-align: center;"><span class="kpi-value"
                                                id="audit-comp-pendente">0</span>
                                            <div style="font-size:0.7rem; color:var(--text-muted);">Esquecidos/Pendentes
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="data-table" id="audit-comp-table">
                                        <thead>
                                            <tr>
                                                <th>Cliente</th>
                                                <th>Rotina Auditada</th>
                                                <th>Prazo Original (Deadline)</th>
                                                <th>Data Real da Baixa</th>
                                                <th>Veredito (Status do Mês)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Populated dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div> <!-- End Settings Content Panes -->
                </div> <!-- End Settings Layout -->
            </div>

        </main>
    </div>

    <!-- Details and Checklist Modal -->
    <div class="modal-overlay" id="task-modal">
        <div class="glass-card modal-content">
            <header class="modal-header">
                <h2>Rotina: <span id="modal-rotina-name" class="highlight-text"></span></h2>
                <button class="close-btn" id="close-modal"><i class="fa-solid fa-xmark"></i></button>
            </header>

            <div class="modal-body">
                <div class="task-info-grid">
                    <div class="info-group">
                        <label>Cliente</label>
                        <p id="modal-cliente"></p>
                    </div>
                    <div class="info-group">
                        <label>Prazo de Entrega</label>
                        <p id="modal-prazo"></p>
                    </div>
                    <div class="info-group">
                        <label>Status Sistema</label>
                        <p id="modal-status"></p>
                    </div>
                </div>

                <div class="checklist-section">
                    <div class="checklist-header">
                        <h3><i class="fa-solid fa-list-check"></i> Checklist Operacional Automático</h3>
                        <span class="progress-text" id="modal-progress-text">0% Concluído</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="modal-progress" style="width: 0%"></div>
                    </div>
                    <div class="checklist-items" id="modal-checklist">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <div class="actions-section">
                    <label class="custom-toggle">
                        <input type="checkbox" id="modal-done-toggle">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Marcar Rotina como Feita</span>
                    </label>
                </div>
            </div>

            <footer class="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">Sair</button>
                <button class="btn btn-primary" id="modal-save">Salvar Alterações</button>
            </footer>
        </div>
    </div>

    <!-- Add/Edit Client Modal -->
    <div class="modal-overlay" id="add-client-modal">
        <div class="glass-card modal-content" style="max-width: 500px;">
            <header class="modal-header">
                <h2 id="modal-client-title"><i class="fa-solid fa-user-plus highlight-text"></i> Novo Cliente</h2>
                <button class="close-btn" id="close-client-modal"><i class="fa-solid fa-xmark"></i></button>
            </header>

            <div class="modal-body" style="padding-bottom: 0;">
                <form id="add-client-form">
                    <input type="hidden" id="client-id" value="">
                    <div class="form-group">
                        <label>Razão Social</label>
                        <input type="text" id="client-razao" required class="glass-input"
                            placeholder="Ex: Nova Empresa Ltda">
                    </div>
                    <div class="form-group">
                        <label>CNPJ</label>
                        <input type="text" id="client-cnpj" required class="glass-input"
                            placeholder="00.000.000/0001-00">
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Regime Tributário</label>
                            <select id="client-regime" class="glass-select" style="width: 100%;">
                                <option value="Simples Nacional">Simples Nacional</option>
                                <option value="Lucro Presumido">Lucro Presumido</option>
                                <option value="Lucro Real">Lucro Real</option>
                                <option value="MEI">MEI</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group"
                        style="margin-top: 1.5rem; background: rgba(0,0,0,0.1); padding: 1rem; border-radius: var(--radius-md);">
                        <label style="margin-bottom: 0.5rem; display:block;"><i class="fa-solid fa-layer-group"></i>
                            Rotinas Aplicáveis (Opcional)</label>
                        <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.8rem;">Marque as rotinas
                            que este cliente deve realizar (também pode ser feito pelo menu de Rotinas).</p>
                        <div id="rotinas-checkbox-grid" class="form-grid"
                            style="gap: 0.5rem; grid-template-columns: 1fr 1fr; max-height: 200px; overflow-y: auto;">
                            <!-- Checkboxes injected by app.js -->
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label><i class="fa-brands fa-google-drive"></i> Link da Pasta no Drive</label>
                        <input type="url" id="client-drive" class="glass-input"
                            placeholder="Ex: https://drive.google.com/drive/folders/...">
                    </div>
                </form>
            </div>

            <footer class="modal-footer">
                <button class="btn btn-secondary" id="client-modal-cancel">Cancelar</button>
                <button class="btn btn-primary" form="add-client-form" type="submit"
                    id="client-modal-submit-btn">Cadastrar Cliente</button>
            </footer>
        </div>
    </div>

    <!-- Add Funcionario Modal -->
    <div class="modal-overlay" id="add-equipe-modal">
        <div class="glass-card modal-content" style="max-width: 400px;">
            <header class="modal-header">
                <h2 id="modal-equipe-title"><i class="fa-solid fa-user-shield highlight-text"></i> Novo Funcionário</h2>
                <button class="close-btn" id="close-equipe-modal"><i class="fa-solid fa-xmark"></i></button>
            </header>

            <div class="modal-body" style="padding-bottom: 0;">
                <form id="add-equipe-form">
                    <input type="hidden" id="equipe-id" value="">
                    <div class="form-group" id="equipe-status-container" style="display: none; margin-bottom: 1rem;">
                        <label class="custom-toggle" style="justify-content: flex-start; gap: 0.5rem;">
                            <input type="checkbox" id="equipe-ativo" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label" style="font-weight: 500;">Conta Ativa</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Nome Completo</label>
                        <input type="text" id="equipe-nome" required class="glass-input" placeholder="Ex: João Silva">
                    </div>
                    <div class="form-group">
                        <label>Setor Principal</label>
                        <select id="equipe-setor" class="glass-select" style="width: 100%;">
                            <!-- Populated dynamically via JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nível de Permissão</label>
                        <select id="equipe-permissao" class="glass-select" style="width: 100%;">
                            <option value="Operacional">Operacional (Apenas suas tarefas)</option>
                            <option value="Supervisor">Supervisor (Visualiza equipe)</option>
                            <option value="Gerente">Gerente (Acesso Total + Dashboards)</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label>Senha de Acesso</label>
                        <input type="password" id="equipe-senha" required class="glass-input" placeholder="Ex: 123">
                    </div>
                </form>
            </div>

            <footer class="modal-footer">
                <button class="btn btn-secondary" id="equipe-modal-cancel">Cancelar</button>
                <button class="btn btn-primary" form="add-equipe-form" type="submit">Cadastrar</button>
            </footer>
        </div>
    </div>

    <!-- Removed Add Rotina Modal in favor of full page view -->

    <!-- Nova Mensagem Modal -->
    <div class="modal-overlay" id="nova-mensagem-modal">
        <div class="glass-card modal-content" style="max-width: 500px;">
            <header class="modal-header">
                <h2><i class="fa-solid fa-envelope highlight-text"></i> Enviar Mensagem</h2>
                <button class="close-btn" id="close-mensagem-modal"><i class="fa-solid fa-xmark"></i></button>
            </header>

            <div class="modal-body" style="padding-bottom: 0;">
                <form id="nova-mensagem-form">
                    <div class="form-group">
                        <label>Para (Destinatário)</label>
                        <select id="msg-destinatario" class="glass-select" style="width: 100%;" required>
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mensagem</label>
                        <textarea id="msg-texto" required class="glass-input" rows="4"
                            placeholder="Escreva seu recado aqui..."></textarea>
                    </div>
                </form>
            </div>

            <footer class="modal-footer">
                <button class="btn btn-secondary" id="mensagem-modal-cancel">Cancelar</button>
                <button class="btn btn-primary" form="nova-mensagem-form" type="submit"><i
                        class="fa-solid fa-paper-plane"></i> Enviar</button>
            </footer>
        </div>
    </div>

    <!-- Manage Setores Modal -->
    <div class="modal-overlay" id="manage-setores-modal">
        <div class="glass-card modal-content" style="max-width: 400px;">
            <header class="modal-header">
                <h2><i class="fa-solid fa-list-ul highlight-text"></i> Gerenciar Setores</h2>
                <button class="close-btn" id="close-setores-modal"><i class="fa-solid fa-xmark"></i></button>
            </header>

            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label>Adicionar Novo Setor</label>
                    <div style="display:flex; gap:0.5rem; margin-bottom:0.5rem;">
                        <input type="text" id="new-setor-name" class="glass-input" placeholder="Ex: Financeiro">
                        <button type="button" class="btn btn-primary" id="btn-add-setor-submit"
                            style="padding: 0 1rem;"><i class="fa-solid fa-plus"></i> Incluir</button>
                    </div>
                </div>

                <label>Setores Existentes no Sistema</label>
                <ul id="setores-list-preview"
                    style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:0.25rem; max-height: 200px; overflow-y: auto;">
                    <!-- Injetado por JS -->
                </ul>
            </div>

            <footer class="modal-footer">
                <button class="btn btn-secondary" id="setores-modal-close-btn">Fechar</button>
            </footer>
        </div>
    </div>

    <!-- Admin Cargo Modal (RBAC) -->
    <div class="modal-overlay" id="admin-cargo-modal">
        <div class="glass-card modal-content" style="max-width: 500px;">
            <header class="modal-header">
                <h2><i class="fa-solid fa-shield-halved highlight-text"></i> Configurar Cargo</h2>
                <button class="close-btn" id="close-cargo-modal"><i class="fa-solid fa-xmark"></i></button>
            </header>

            <div class="modal-body">
                <form id="admin-cargo-form">
                    <input type="hidden" id="cargo-id">
                    <div class="form-group">
                        <label>Nome do Cargo</label>
                        <input type="text" id="cargo-nome" class="glass-input" placeholder="Ex: Analista Fiscal Jr"
                            required>
                    </div>

                    <div class="form-group" style="margin-top: 1.5rem;">
                        <label style="margin-bottom: 1rem;">Módulos Permitidos (Telas)</label>
                        <div id="cargo-permissions-list"
                            style="display: flex; flex-direction: column; gap: 0.8rem; background: rgba(15, 23, 42, 0.4); padding: 1rem; border-radius: var(--radius-md); border: 1px solid var(--border-glass);">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" value="dashboard" class="cargo-perm-check"> Manager Dashboard
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" value="operacional" class="cargo-perm-check"> Painel Operacional
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" value="meu-desempenho" class="cargo-perm-check"> Meu Desempenho
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" value="clientes" class="cargo-perm-check"> Gestão de Clientes
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" value="equipe" class="cargo-perm-check"> Gestão de Equipe
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" value="rotinas" class="cargo-perm-check"> Gestão de Rotinas
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" value="mensagens" class="cargo-perm-check"> Mensagens (Inbox)
                            </label>
                            <div class="nav-divider" style="margin: 0.5rem 0;"></div>
                            <label
                                style="display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--danger);">
                                <input type="checkbox" value="settings" class="cargo-perm-check"> Painel de Controle
                                (Acesso Master Hub)
                            </label>
                        </div>
                    </div>
                </form>
            </div>

            <footer class="modal-footer">
                <button class="btn btn-secondary" id="cargo-modal-cancel">Cancelar</button>
                <button class="btn btn-primary" form="admin-cargo-form" type="submit">Salvar Permissões</button>
            </footer>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/store.js?v=1.1"></script>
    <script src="js/app.js?v=1.1"></script>
</body>

</html>